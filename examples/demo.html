<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>冒泡排序动画 | Bubble Sort Animation</title>
    <style>
        /* --- Google Fonts --- */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Noto+Sans+SC:wght@400;500&display=swap');

        /* --- 基本重置和页面布局 --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #f0f4f8; /* 淡雅的背景色 */
            font-family: 'Poppins', 'Noto Sans SC', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- 动画主容器 (保持16:9比例，适配2K) --- */
        #container {
            position: relative;
            width: 100vw;
            height: 56.25vw; /* 16:9 Aspect Ratio */
            max-width: 177.78vh; /* 16:9 Aspect Ratio */
            max-height: 100vh;
            background: linear-gradient(135deg, #e0f7fa 0%, #d1c4e9 100%);
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            animation: background-pan 20s linear infinite;
        }

        @keyframes background-pan {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* --- 标题画面 --- */
        #title-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #1a237e;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            z-index: 100;
        }
        #title-screen h1 {
            font-size: clamp(3rem, 5vw, 5rem); /* 响应式字体 */
            font-weight: 600;
            margin-bottom: 1rem;
        }
        #title-screen p {
            font-size: clamp(1.2rem, 2vw, 2rem);
            color: #3f51b5;
        }
        
        /* --- 动画场景 --- */
        #scene {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        /* --- SVG画布用于绘制气泡 --- */
        #canvas {
            width: 100%;
            height: 100%;
        }

        /* --- 气泡样式 --- */
        .bubble circle {
            stroke-width: 4px;
            stroke: #4db6ac;
            fill: #e0f2f1;
            transition: transform 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55), 
                        fill 0.5s ease, stroke 0.5s ease;
        }

        .bubble text {
            font-family: 'Poppins', sans-serif;
            font-size: 40px;
            font-weight: 600;
            fill: #004d40;
            text-anchor: middle;
            dominant-baseline: central;
            transition: transform 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }

        /* 气泡状态: 高亮 */
        .bubble.highlight circle {
            fill: #fff9c4;
            stroke: #ffca28;
            filter: drop-shadow(0 0 10px #ffca28);
        }
        .bubble.highlight text {
            fill: #f57f17;
        }
        
        /* 气泡状态: 比较但不需要交换 */
        .bubble.compare-ok circle {
             fill: #c8e6c9;
             stroke: #66bb6a;
        }
        .bubble.compare-ok text {
            fill: #2e7d32;
        }
        
        /* 气泡状态: 已排序 */
        .bubble.sorted circle {
            fill: #cfd8dc;
            stroke: #78909c;
        }
        .bubble.sorted text {
            fill: #37474f;
        }
        
        /* --- 旁白/字幕 --- */
        #narration {
            position: absolute;
            bottom: 5%;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            text-align: center;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        #narration p {
            padding: 10px 20px;
            border-radius: 12px;
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(5px);
            display: inline-block;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        #narration-cn {
            font-size: clamp(1.2rem, 1.8vw, 1.8rem);
            color: #0d47a1;
            font-weight: 500;
        }
        #narration-en {
            font-size: clamp(0.9rem, 1.3vw, 1.3rem);
            color: #455a64;
            margin-top: 5px;
        }

        /* --- 伪代码区域 --- */
        #pseudo-code {
            position: absolute;
            right: 3%;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(5px);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            width: 25%;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }
        #pseudo-code h3 {
            font-size: clamp(1.1rem, 1.4vw, 1.4rem);
            color: #1a237e;
            border-bottom: 2px solid #9fa8da;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        #pseudo-code pre {
            font-family: 'Courier New', Courier, monospace;
            font-size: clamp(0.8rem, 1vw, 1rem);
            line-height: 1.8;
            color: #333;
        }
        #pseudo-code code span {
            display: block;
            padding: 2px 8px;
            border-radius: 4px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        #pseudo-code code span.highlight-code {
            background-color: #ffeb3b;
            color: #333;
        }
    </style>
</head>
<body>

    <div id="container">
        <div id="title-screen">
            <h1>冒泡排序</h1>
            <p>Bubble Sort</p>
        </div>
        
        <div id="scene">
            <svg id="canvas"></svg>
        </div>

        <div id="narration">
            <p id="narration-cn"></p>
            <p id="narration-en"></p>
        </div>

        <div id="pseudo-code">
            <h3>Pseudo Code</h3>
            <pre><code id="code-block">
<span data-line="1">function BubbleSort(array):</span>
<span data-line="2">  n = length of array</span>
<span data-line="3">  repeat</span>
<span data-line="4">    swapped = false</span>
<span data-line="5">    for i from 0 to n-2:</span>
<span data-line="6">      if array[i] > array[i+1]:</span>
<span data-line="7">        swap(array[i], array[i+1])</span>
<span data-line="8">        swapped = true</span>
<span data-line="9">    n = n - 1</span>
<span data-line="10">  until not swapped or n <= 1</span>
            </code></pre>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- 配置和全局变量 ---
        const svgNS = "http://www.w3.org/2000/svg";
        const canvas = document.getElementById('canvas');
        const narrationCn = document.getElementById('narration-cn');
        const narrationEn = document.getElementById('narration-en');
        const narrationBox = document.getElementById('narration');
        const titleScreen = document.getElementById('title-screen');
        const pseudoCodeBox = document.getElementById('pseudo-code');
        const codeLines = document.querySelectorAll('#code-block span');

        const initialArray = [42, 34, 25, 12, 22, 11, 90];
        let bubbleData = initialArray.map((value, index) => ({ id: `bubble-${index}`, value, originalIndex: index }));
        
        const bubbleRadius = 45;
        const bubbleSpacing = 120; // 中心间距
        const startX = 2560 / 2 - (initialArray.length - 1) * bubbleSpacing / 2;
        const startY = 1440 / 2 - 100; // 调整垂直位置

        let timeline = [];
        let currentStep = 0;

        // --- 核心功能函数 ---
        
        // 创建初始的气泡
        function createBubbles() {
            bubbleData.forEach((data, index) => {
                const group = document.createElementNS(svgNS, 'g');
                group.setAttribute('id', data.id);
                group.setAttribute('class', 'bubble');
                group.style.transform = `translateX(${startX + index * bubbleSpacing}px) translateY(${startY}px)`;

                const circle = document.createElementNS(svgNS, 'circle');
                circle.setAttribute('r', bubbleRadius);

                const text = document.createElementNS(svgNS, 'text');
                text.textContent = data.value;

                group.appendChild(circle);
                group.appendChild(text);
                canvas.appendChild(group);
                
                // 存储 DOM 元素引用
                data.element = group;
            });
        }

        // 显示旁白
        function showNarration(cn, en, duration = 1000) {
            return new Promise(resolve => {
                narrationBox.style.opacity = '0';
                setTimeout(() => {
                    narrationCn.innerHTML = cn;
                    narrationEn.innerHTML = en;
                    narrationBox.style.opacity = '1';
                    setTimeout(resolve, duration);
                }, 500); // 等待淡出
            });
        }

        // 隐藏旁白
        function hideNarration() {
            narrationBox.style.opacity = '0';
        }

        // 高亮伪代码行
        function highlightCode(lines = []) {
             return new Promise(resolve => {
                codeLines.forEach(line => line.classList.remove('highlight-code'));
                if (Array.isArray(lines)) {
                    lines.forEach(lineNumber => {
                        const line = document.querySelector(`[data-line="${lineNumber}"]`);
                        if (line) line.classList.add('highlight-code');
                    });
                }
                resolve();
            });
        }

        // 高亮比较的元素
        function highlightElements(indices, className = 'highlight') {
            return new Promise(resolve => {
                document.querySelectorAll('.bubble').forEach(b => {
                    b.classList.remove('highlight', 'compare-ok');
                });
                indices.forEach(i => {
                    if (bubbleData[i] && bubbleData[i].element) {
                        bubbleData[i].element.classList.add(className);
                    }
                });
                resolve();
            });
        }

        // 交换两个元素的位置
        function swapElements(index1, index2) {
            return new Promise(resolve => {
                const bubble1 = bubbleData[index1];
                const bubble2 = bubbleData[index2];

                // 交换数据
                [bubbleData[index1], bubbleData[index2]] = [bubbleData[index2], bubbleData[index1]];

                // 获取当前位置并应用变换
                const el1 = bubble1.element;
                const el2 = bubble2.element;
                
                const transform1 = `translateX(${startX + index2 * bubbleSpacing}px) translateY(${startY}px)`;
                const transform2 = `translateX(${startX + index1 * bubbleSpacing}px) translateY(${startY}px)`;

                el1.style.transform = transform1;
                el2.style.transform = transform2;
                
                // 等待CSS transition完成
                setTimeout(resolve, 800);
            });
        }

        // 标记元素为已排序
        function markSorted(index) {
             return new Promise(resolve => {
                const bubble = bubbleData[index];
                if (bubble && bubble.element) {
                    bubble.element.classList.remove('highlight');
                    bubble.element.classList.add('sorted');
                }
                resolve();
            });
        }

        // --- 构建动画时间线 ---
        function buildTimeline() {
            // 1. 开场
            timeline.push(async () => {
                titleScreen.style.opacity = '1';
                await new Promise(r => setTimeout(r, 4000));
                titleScreen.style.opacity = '0';
                await new Promise(r => setTimeout(r, 1000));
                pseudoCodeBox.style.opacity = '1';
            });
            
            // 2. 介绍算法
            timeline.push(() => showNarration(
                "今天，我们来探索一种经典排序算法——冒泡排序。",
                "Today, let's explore a classic sorting algorithm - Bubble Sort.",
                4000
            ));
            timeline.push(() => showNarration(
                "它的核心思想是：重复地遍历要排序的数列，一次比较两个元素。",
                "Its core idea is to repeatedly step through the list, comparing adjacent elements.",
                4000
            ));
            timeline.push(() => showNarration(
                "如果它们的顺序错误就把它们交换过来。这个过程就像气泡从水底冒上来一样。",
                "If they are in the wrong order, they are swapped. This process resembles bubbles rising from the bottom of a liquid.",
                5000
            ));
            
            // 3. 冒泡排序过程
            let n = bubbleData.length;
            let swapped;
            let passes = 0;
            
            timeline.push(() => highlightCode([3]));

            do {
                swapped = false;
                passes++;
                
                timeline.push(() => showNarration(`第 ${passes} 轮比较开始...`, `Starting Pass ${passes}...`, 2000));
                timeline.push(() => highlightCode([4, 5]));
                
                for (let i = 0; i < n - 1; i++) {
                    const j = i + 1;
                    
                    timeline.push(() => highlightElements([i, j]));
                    timeline.push(() => highlightCode([6]));
                    timeline.push(() => showNarration(
                        `比较 ${bubbleData[i].value} 和 ${bubbleData[j].value}。`,
                        `Comparing ${bubbleData[i].value} and ${bubbleData[j].value}.`,
                        1500
                    ));

                    if (bubbleData[i].value > bubbleData[j].value) {
                        swapped = true;
                        
                        timeline.push(() => highlightCode([7, 8]));
                        timeline.push(() => showNarration(
                            `${bubbleData[i].value} > ${bubbleData[j].value}，需要交换位置。`,
                            `${bubbleData[i].value} > ${bubbleData[j].value}, a swap is needed.`,
                            1500
                        ));
                        timeline.push(() => swapElements(i, j));
                        timeline.push(() => new Promise(r => setTimeout(r, 500))); // 交换后的小暂停
                    } else {
                        timeline.push(() => highlightElements([i, j], 'compare-ok'));
                        timeline.push(() => showNarration(
                            `${bubbleData[i].value} <= ${bubbleData[j].value}，顺序正确，无需交换。`,
                            `${bubbleData[i].value} <= ${bubbleData[j].value}, order is correct, no swap.`,
                            1500
                        ));
                    }
                }
                
                n--;
                timeline.push(() => highlightElements([])); // 清除高亮
                timeline.push(() => highlightCode([9]));
                timeline.push(() => markSorted(n));
                timeline.push(() => showNarration(
                    `第 ${passes} 轮结束。最大的元素 ${bubbleData[n].value} 已“冒泡”到正确位置。`,
                    `Pass ${passes} complete. The largest element ${bubbleData[n].value} has "bubbled up" to its correct position.`,
                    4000
                ));
                timeline.push(() => highlightCode([10]));
            } while (swapped);
            
             // 标记剩余已排序的元素
            timeline.push(() => {
                return new Promise(resolve => {
                    for(let i = 0; i < n; i++) {
                        markSorted(i);
                    }
                    resolve();
                });
            });

            // 4. 结束语
            timeline.push(() => highlightCode([]));
            timeline.push(() => showNarration(
                "所有轮次结束，数组已经完全有序。",
                "All passes are finished, the array is now fully sorted.",
                4000
            ));
            timeline.push(() => showNarration(
                "这就是冒泡排序的完整过程。简单直观，但对于大数据集效率较低。",
                "This is the complete process of Bubble Sort. It's simple and intuitive, but less efficient for large datasets.",
                5000
            ));
             timeline.push(() => showNarration(
                "感谢观看！",
                "Thanks for watching!",
                3000
            ));
        }

        // --- 动画播放器 ---
        async function playTimeline() {
            for (const action of timeline) {
                await action();
            }
        }

        // --- 初始化 ---
        createBubbles();
        buildTimeline();
        playTimeline();
    });
    </script>

</body>
</html>